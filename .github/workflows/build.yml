name: BUILD

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  buildAUR:
    strategy:
      matrix:
        repos: [04b_21,0ad-boongui,0ad-community-maps-2,0ad-delenda-est,0ad-git,0ad-data-git,0ad-zh-lang,0cc-famitracker,0verkill-git,0x0uploader,0xdbe-eap,0xffff,10ff-git,115pc,123-bin,1337,1c_enterprise_meta,1oom-git,1pass-autologin,1pass-git,1pass-hg,1password,1password-beta,1password-cli,1px-git,2009scape,2009scape-git,2048-cli-git,2048-curses,2048-gui-git,2048-puzzle-bash-git,2048-py,2048-qt,2048-rs,2048-vanced,2048-vanced-git,2048.c,2048.c-git,2048.cpp-git,2048term-git,20kly,20kly-git,2bwm,2bwm-git,2cdt,2dtiler-bin,2fa,2gis,2mandvd,2p-kt,2ping,2plan-desktop,3270-fonts,35c3_char-dkms-git,360cloud,360player,360zip,389-admin,389-admin-console,389-adminutil,389-console,389-ds-console,3delta-git,3dfsb,3dm2,3dmeshmetric-bin,3dsconv,3dslicer,3dslicer-bin,3dslicer-git,3dslicer-nightly,3dslicer-nightly-bin,3dstool,3dstool-git,3dstools,3mf2stl,3mux,3mux-git,3ncode-git,3proxy,3to2,4chan-downloader,4dtris,4kslideshowmaker,4kstogram,4ktokkit,4kvideodownloader,4kvideotomp3,4kyoutubetomp3,4l,4nxci-bin,4nxci-git,4pane,4scanner,4store,4suite,4th,555-boom,5up,602xmlfiller,64gram-desktop,64gram-desktop-bin,64gram-desktop-no-ad,6pm,6sv11,7-zip,7-zip-bin,7-zip-full,7kaa,7kaa-music,8085-simulator,8188eu-aircrack-dkms-git,8188eu-dkms,8188eu-dkms-git,8188fu-dkms-git,8188fu-kelebek333-dkms-git,8189fs-git,8192cu-dkms,8192eu-dkms,8192eu-dkms-git,86box,86box-appimage,86box-git,86box-qt5-git,86box-roms,86box-roms-git,8723bs-git,8723bs-git-dkms,8cc-git,915resolution,9anime,9base-git,9front-drawterm-hg,9menu,9menu-git,9mount,9pfuse,9wm,a,a-git,a-john-shots,a2enmod-git,a2ln,a2pdf,a2png,a4tech-bloody-driver-git,a7800,a7xpg,a850-fw,aa3d,aaaaxy,aacgain-cvs,aacplusenc,aacskeys,aaflib,aafm-git,aaphoto,aarch64-binutils,aarch64-elf-gcc-linaro-bin,aarch64-elf-newlib-linaro-bin,aarch64-gcc,aarch64-gcc-bootstrap,aarch64-glibc,aarch64-linux-api-headers,aarch64-linux-gnu-armcl-neon,aarch64-linux-gnu-armcl-opencl+neon,aarch64-linux-gnu-fakeroot,aarch64-linux-gnu-gcc49-linaro-bin,aarch64-linux-gnu-binutils224-linaro-bin,aarch64-linux-gnu-eglibc219-linaro-bin,aarch64-linux-gnu-gdb710-linaro-bin,aarch64-linux-gnu-gcc55,aarch64-linux-gnu-gcc75-linaro-bin,aarch64-linux-gnu-hwloc,aarch64-linux-gnu-openblas-lapack-openmp,aarch64-linux-gnu-openssl,aarch64-linux-gnu-pkg-config,aarch64-linux-gnu-xorg-util-macros,aarch64-linux-musl,aarch64-linux-musl-cross-bin,aarch64-none-elf-gcc-bin,aarch64-none-elf-gdb,aarch64-none-elf-toolchain,aarch64-none-linux-gnu-gcc-10.3-bin,aarch64-none-linux-gnu-gcc-9.2-bin,aarchup,aarchup-git,aard2-slob,aareguru-cli,aaregurucli-git,aaronia-mcs,aaru,aaru-git,aasdk-git,aavmf-bin,aaxtomp3,aaxtomp3-git,ab-av1,abaddon,abaddon-git,abbaye-des-morts,abbrase-git,abc-git,abc80sim-git,abcde,abcde-musicbrainz-meta,abchr,abcl,abcl-git,abcm2ps,abcmidi,abcpp,abctab2ps,abduco-git,abe,abeceda_convertor-git,abeep-git,abella,abeluna,abfetch,abgate.lv2,abgx360,abgx360gui,abi-compliance-checker,abi-dumper,abinit,abiocard,abireport,abiword-git,abiword-gtk2,ablavema-bin,abnt2-ext,abntex,abntex2,abook,abook-configdir,abootimg,abootimg-git,abr2gbr,abra-git,abraca,abraca-git,abricotine,abricotine-bin,abricotine-git,abrowser-bin,abrus-gtk-theme-git,abseil-cpp-git,absolute-theme,absolutely-proprietary,abstouch-nux,abstreet-git,abswitchstereo-lv2-git,abuild,abunchoftags]

      fail-fast: false
      
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v2
    
    - uses: ./build-aur-action
      with:
        repo-name: ${{ matrix.repos }}
    
    - uses: actions/upload-artifact@v2
      with:
        path: ./*/*.pkg.tar.zst
        name: ${{ matrix.repos }}
        
    - uses: ncipollo/release-action@v1
      with:
        allowUpdates: true
        tag: "packages"
        artifacts: "./*/*.zst"
        token: ${{ secrets.GITHUB_TOKEN }}
  two:
    strategy:
      matrix:
        repos: [abunchoftags,abuse,abv-calc-git,abx,abyss,abyss-engine-git,abzer-git,ac-library,acado,acalc-git,acarsdec,acarsdec-git-airspy,acarsdec-git-rtl-sdr,acarsserv-git,acbuild-git,acc,acc-git,accel-ppp,accel-ppp-git,accel-ppp-ipoe-dkms,accel-ppp-ipoe-dkms-git,accel-ppp-vlanmon-dkms,accel-ppp-vlanmon-dkms-git,accelerated-domains-china-list-git,accepted,access-export,accio-git,accountable2you-bin,accountsservice-elogind,acct,acct-svn,acdcontrol-git,acd_cli,acd_cli-git,ace,ace-of-penguins,acers3fand,aces-container,acestream-engine,acestream-engine-stable,acestream-launcher,acestream-proxy,acestream-proxy-git,acestream-proxy-player,achannarasappa-ticker,achilles,aci-discovery-git,acid-gtk-theme,acidrip,ack-git,acl-git,acl2,acl4ssr-acl-git,aclock,acme-dns,acme-dns-bin,acme-edit-git,acme-git,acme-sac,acme-tiny-wrapper,acme-upstream,acme.sh-git,acme.sh-systemd,acmed,acmed-polkit-reload,acmetool,acmetool-bin,acmetool-git,acmt-acm210-vst,acmt-acm210-vst3,acmt-acm210-docs,acmt-acm210-bin,acmt-acm2a-vst,acmt-acm2a-vst3,acmt-acm2a-docs,acmt-acm2a-bin,acmt-acm500-vst,acmt-acm500-vst3,acmt-acm500-docs,acmt-acm500-bin,acmt-acm510-vst,acmt-acm510-vst3,acmt-acm510-docs,acmt-acm510-bin,acmt-acm510a-vst,acmt-acm510a-vst3,acmt-acm510a-docs,acmt-acm510a-bin,acmt-acm5a-vst,acmt-acm5a-vst3,acmt-acm5a-docs,acmt-acm5a-bin,acmt-acm70-vst,acmt-acm70-vst3,acmt-acm70-docs,acmt-acm70-bin,acolor-git,aconcat,aconfmgr-git,acousticbrainz-client,acousticbrainz-client-git,acousticbrainz-gui-git,acoustid-fingerprinter,acp3x-rn-dkms,acpi-msi-ge62-git,acpi-unified-patch,acpilight-git,acpitool,acpi_call-ck,acpi_call-pf,acpush,acquire_rs,acquisition,acquisition-git,acr-git,acroread,acroread-fonts,acroread-fonts-systemwide,across,acserver,acserver-blablacar,act,act-bin,act-git,actdiag,actiona,actionfps,actionlint,actionlint-bin,activate-linux,activate-linux-git,activate-linux-wayland-git,activdriver,active-data,activecollab-timer,activecollab5-timer,activemq,activemq-runit,activinspire,activinspire-sk,activity-relay,activityfox-git,activitywatch-bin,activrelay,activtools,actkbd,actool-git,actor-framework,acts,acts-git,actual-appimage,acyls-icon-theme-git,ad-git,ada-libfswatch,ada-libfswatch-git,ada-web-server,adabooch,adacurses,adafruit-ampy,adapta-aurorae-theme-git,adapta-backgrounds,adapta-gtk-theme-3.94,adapta-gtk-theme-bin,adapta-gtk-theme-colorpack,adapta-gtk-theme-colorpack-joshaby-git,adapta-gtk-theme-git,adapta-gtk-theme-legacy-git,adapta-gtk-theme-wal,adapta-kde,kvantum-theme-adapta,adapta-kde-git,adapta-kde-wallpapers-git,adapta-nokto-cinnamon-cantarell,adapta-nokto-dropbox-icons,adapta-nord-git,adaptagrams-git,adaptativeneuralnetwork,adara-theme-git,adasockets,ada_language_server,ada_language_server-git,ada_spawn,adb-screen-tools,adb-starter,adb-sync-git,adbcontrol,adbfs-git,adbfs-rootless-git,adblock2privoxy,adbtuifm,adbtuifm-bin,adcd,adchpp,adchpp-hg,adchpp-lan-bzr,adcli,adcli-git,add-gitignore,addic7ed-cli,addinclude,addinclude-git,addmag,addresses.app,addrwatch,addrwatch-git,adduser,ade,adebar,adeos-oblogout-git,adept-git,adesklet-adeskclock,adesklet-aurnotify,adesklet-calendar,adesklets,adflib,adflite-git,adg-gtk-theme,adguardhome,adguardhome-bin,adhocspot-script-git,adhosts,adif2cabrillo,adios,adios2-git,adjbacklight,adjtimex,adl-git,adlmapps,adlmidi-git,adlplug-git,opnplug-git,admbrowser-git,admesh,admin-git,adminer,adminer-editor,adminer-git,adminer-skins-brade,adminer-skins-bueltge,adminer-skins-cvicebni-ubor,adminer-skins-galkaev,adminer-skins-haeckel,adminer-skins-hever,adminer-skins-jukin,adminer-skins-kahi,adminer-skins-konya,adminer-skins-nette,adminer-skins-ng9,adminer-skins-nicu,adminer-skins-pappu687,adminer-skins-paranoiq,adminer-skins-pepa-linha,adminer-skins-pilot,adminer-skins-pokorny,adminer-skins-price]
      fail-fast: false
      
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v2
    
    - uses: ./build-aur-action
      with:
        repo-name: ${{ matrix.repos }}
    
    - uses: actions/upload-artifact@v2
      with:
        path: ./*/*.pkg.tar.zst
        name: ${{ matrix.repos }}
        
    - uses: ncipollo/release-action@v1
      with:
        allowUpdates: true
        tag: "packages"
        artifacts: "./*/*.zst"
        token: ${{ secrets.GITHUB_TOKEN }}
